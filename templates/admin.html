<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ü–∞—Ä—Å–µ—Ä –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">–°–æ–∑–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é</h2>
                <form id="createLicenseForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞:</label>
                        <input type="text" id="ownerName" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email:</label>
                        <input type="email" id="email" required
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–¥–Ω–µ–π):</label>
                        <input type="number" id="durationDays" value="30" min="1"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">–ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å:</label>
                        <input type="number" id="requestsPerDay" value="100" min="1"
                               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        –°–æ–∑–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é
                    </button>
                </form>
                
                <div id="licenseResult" class="mt-4 hidden p-4 bg-green-100 border border-green-400 rounded">
                    <h3 class="font-semibold">–õ–∏—Ü–µ–Ω–∑–∏—è —Å–æ–∑–¥–∞–Ω–∞!</h3>
                    <p id="licenseKeyOutput" class="font-mono mt-2"></p>
                </div>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ –ª–∏—Ü–µ–Ω–∑–∏–π -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">–ê–∫—Ç–∏–≤–Ω—ã–µ –ª–∏—Ü–µ–Ω–∑–∏–∏</h2>
                <button onclick="loadLicenses()" 
                        class="mb-4 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700">
                    –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                </button>
                <div id="licensesList" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('createLicenseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('owner_name', document.getElementById('ownerName').value);
            formData.append('email', document.getElementById('email').value);
            formData.append('duration_days', document.getElementById('durationDays').value);
            formData.append('requests_per_day', document.getElementById('requestsPerDay').value);
            
            try {
                const response = await fetch('/api/admin/licenses', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('licenseKeyOutput').textContent = data.license_key;
                    document.getElementById('licenseResult').classList.remove('hidden');
                    document.getElementById('createLicenseForm').reset();
                    loadLicenses();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.detail);
                }
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        });
        
        async function loadLicenses() {
            try {
                const response = await fetch('/api/admin/licenses');
                const licenses = await response.json();
                
                const container = document.getElementById('licensesList');
                
                if (licenses.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">–õ–∏—Ü–µ–Ω–∑–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    return;
                }
                
                let html = '';
                licenses.forEach(license => {
                    const status = license.is_active ? 
                        (new Date(license.expires_at) > new Date() ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : 'üî¥ –ò—Å—Ç–µ–∫–ª–∞') : 
                        '‚ö´ –ù–µ–∞–∫—Ç–∏–≤–Ω–∞';
                    
                    html += `
                        <div class="border rounded-lg p-4 ${!license.is_active ? 'bg-gray-100' : ''}">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-semibold">${license.owner_name}</h3>
                                    <p class="text-sm text-gray-600">${license.email}</p>
                                    <p class="text-xs font-mono mt-1">${license.key}</p>
                                </div>
                                <span class="text-sm">${status}</span>
                            </div>
                            <div class="mt-2 text-sm">
                                <p>–ó–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${license.today_requests}/${license.requests_per_day}</p>
                                <p>–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${license.total_requests}</p>
                                <p>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${new Date(license.expires_at).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏—Ü–µ–Ω–∑–∏–π: ' + error.message);
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–∏—Ü–µ–Ω–∑–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadLicenses();
    </script>
</body>
</html>
